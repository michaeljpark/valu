<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Marketplace - Manage Assets</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <a href="index.html" class="logo">
                <picture>
                    <source media="(max-width: 768px)" srcset="valuapp.svg">
                    <img src="valuweb.svg" alt="Valu">
                </picture>
            </a>
            <div class="nav-actions">
                <div class="nav-switch">
                    <a href="index.html" class="btn">
                        <i class="fa-regular fa-user"></i> My Value
                    </a>
                    <a href="post.html" class="btn active">
                        <i class="fa-solid fa-list-check"></i> Manage
                    </a>
                    <a href="evaluation.html" class="btn">
                        Evaluation
                    </a>
                </div>
                <a href="marketplace.html" class="btn" style="color: #6B7280;">
                    <i class="fa-solid fa-store"></i> Market
                </a>
            </div>
        </header>

        <div class="post-asset-container">
            <!-- Asset List Section -->
            <div class="assets-section" style="margin-bottom: 32px;">
                <h2 class="section-title">Your Assets</h2>
                <div class="table-container">
                    <table id="manage-asset-table">
                        <thead>
                            <tr>
                                <th>Asset</th>
                                <th>Category</th>
                                <th>Current Value</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="manage-asset-list">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Edit Section (Hidden initially) -->
            <div id="edit-asset-container" style="display: none;">
                <h2 class="section-title">Edit Asset Details</h2>
                <div class="asset-history-card">
                     <div class="asset-content-grid">
                        <div class="asset-info-col">
                            <!-- Editable Fields -->
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Asset Name</label>
                                <input type="text" id="edit-title" class="form-input" style="width: 100%; padding: 12px; border: 1px solid #E2E8F0; border-radius: 8px; font-size: 16px;">
                            </div>
                            
                            <div class="asset-stats-row">
                                <div class="asset-stat-item">
                                    <label>Purchase Price</label>
                                    <input type="number" id="edit-purchase-price" class="form-input" style="width: 100%; padding: 8px; border: 1px solid #E2E8F0; border-radius: 8px;">
                                </div>
                                <div class="asset-stat-item">
                                    <label>Current Value</label>
                                    <div class="value" id="edit-current-value-display" style="margin-top: 8px;">$0</div>
                                </div>
                            </div>

                            <div class="asset-ai-desc">
                                <div class="ai-label">Valu Insight</div>
                                <p class="ai-text" id="edit-ai-desc">Select an asset to see insights.</p>
                            </div>

                            <!-- Valu Score Section -->
                            <div class="valu-score-section">
                                <button id="get-valu-score-btn" class="score-btn">
                                    <i class="fa-solid fa-wand-magic-sparkles"></i> Get Valu Score
                                </button>
                                
                                <div id="valu-score-result" class="score-result-card">
                                    <div class="score-header">
                                        <div class="score-label">
                                            <i class="fa-solid fa-chart-pie"></i> Valu Score
                                        </div>
                                        <span id="score-percentage" class="score-percentage">-</span>
                                    </div>
                                    
                                    <div class="score-breakdown">
                                        <div class="score-item">
                                            <div class="score-item-label">Damage</div>
                                            <div id="score-damage" class="score-item-value">-</div>
                                        </div>
                                        <div class="score-item">
                                            <div class="score-item-label">Rarity</div>
                                            <div id="score-rarity" class="score-item-value">-</div>
                                        </div>
                                        <div class="score-item">
                                            <div class="score-item-label">Demand</div>
                                            <div id="score-demand" class="score-item-value">-</div>
                                        </div>
                                    </div>
                                    <div style="margin-top: 12px; font-size: 10px; color: #94A3B8; text-align: center; font-style: italic;">
                                        * AI analysis based on simulated market data.
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Save button moved to bottom -->
                        </div>
                        
                        <div class="asset-chart-col" id="edit-asset-chart"></div>
                    </div>

                    <!-- Sell Analysis Section -->
                    <div class="sell-analysis-section" style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #E2E8F0;">
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #1E293B;">If you sell this...</h3>
                        <div class="sell-metrics-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                            <!-- Metric 1: Estimated Price -->
                            <div class="sell-metric-card" style="background: #F0FDF4; padding: 20px; border-radius: 12px; border: 1px solid #DCFCE7;">
                                <div style="font-size: 13px; font-weight: 500; color: #166534; margin-bottom: 8px;">Estimated Market Price</div>
                                <div class="metric-value" id="sell-est-price" style="font-size: 32px; font-weight: 700; color: #15803D;">-</div>
                                <div style="font-size: 11px; color: #166534; margin-top: 4px;">Based on market data</div>
                            </div>
                            <!-- Metric 2: Sales Simulator -->
                            <div class="sell-metric-card" style="background: #F8FAFC; padding: 20px; border-radius: 12px; border: 1px solid #F1F5F9;">
                                <div style="font-size: 13px; font-weight: 500; color: #64748B; margin-bottom: 8px;">Sales Speed Simulator</div>
                                <div class="sim-controls-wrapper">
                                    <button class="btn-icon sim-btn" onclick="adjustPricePercent(-0.05)">
                                        <i class="fa-solid fa-minus"></i>
                                    </button>
                                    <div class="sim-input-container">
                                        <span class="sim-currency-symbol">$</span>
                                        <input type="number" id="sim-price-input" class="sim-input-field" onchange="updateSimPriceFromInput(this.value)" />
                                    </div>
                                    <button class="btn-icon sim-btn" onclick="adjustPricePercent(0.05)">
                                        <i class="fa-solid fa-plus"></i>
                                    </button>
                                </div>
                                
                                <!-- Visual Bar -->
                                <div class="price-estimator-container">
                                    <div style="display: flex; justify-content: space-between; font-size: 13px; color: #4B5563; margin-bottom: 4px;">
                                        <span>Est. Time to Sell</span>
                                        <span id="sim-speed-text" style="font-weight: 600; color: #111827;">-</span>
                                    </div>
                                    <div class="time-estimator-bar" style="height: 6px; background: #E2E8F0; border-radius: 100px; overflow: hidden; margin-bottom: 4px;">
                                        <div class="time-estimator-fill" id="sim-speed-bar" style="height: 100%; background: #4F46E5; width: 0%; transition: width 0.3s ease, background-color 0.3s ease;"></div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 11px; color: #9CA3AF;">
                                        <span>Fast</span>
                                        <span>Slow</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Post to Marketplace Button -->
                        <button id="post-marketplace-btn" class="btn-marketplace-action">
                            <i class="fa-solid fa-shop" style="margin-right: 8px;"></i> Post your asset on marketplace
                        </button>
                    </div>

                    <!-- Rent Analysis Section -->
                    <div class="rent-analysis-section" style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #E2E8F0;">
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #1E293B;">If you put it up for rent...</h3>
                        <div class="rent-metrics-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                            <!-- Metric 1: Hourly -->
                            <div class="rent-metric-card" style="background: #F8FAFC; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #F1F5F9;">
                                <div style="font-size: 13px; font-weight: 500; color: #64748B; margin-bottom: 8px;">Hourly</div>
                                <div class="metric-value" id="rent-hourly" style="font-size: 24px; font-weight: 700; color: #0F172A;">-</div>
                            </div>
                            <!-- Metric 2: Daily -->
                            <div class="rent-metric-card" style="background: #F8FAFC; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #F1F5F9;">
                                <div style="font-size: 13px; font-weight: 500; color: #64748B; margin-bottom: 8px;">Daily</div>
                                <div class="metric-value" id="rent-daily" style="font-size: 24px; font-weight: 700; color: #0F172A;">-</div>
                            </div>
                            <!-- Metric 3: Monthly -->
                            <div class="rent-metric-card" style="background: #F8FAFC; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #F1F5F9;">
                                <div style="font-size: 13px; font-weight: 500; color: #64748B; margin-bottom: 8px;">Monthly</div>
                                <div class="metric-value" id="rent-monthly" style="font-size: 24px; font-weight: 700; color: #0F172A;">-</div>
                            </div>
                        </div>
                        
                        <!-- Rent Eligibility Message -->
                        <div id="rent-eligibility-msg" class="rent-eligibility-msg default">
                            <i class="fa-solid fa-circle-info"></i> Check your valu score if you want to put it up for rent!
                        </div>
                    </div>

                    <!-- Action Buttons (Bottom) -->
                    <div class="edit-actions-row" style="margin-top: 24px; display: flex; gap: 12px;">
                        <button id="close-asset-btn" class="btn" style="flex: 1; justify-content: center; background: white; border: 1px solid #E2E8F0; color: #475569; padding: 12px; border-radius: 8px; font-weight: 600;">Close</button>
                        <button id="save-asset-btn" class="btn-primary" style="flex: 1; justify-content: center; padding: 12px; border-radius: 8px;">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- Marketplace Confirmation Modal -->
    <div id="marketplace-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon-wrapper">
                    <i class="fa-solid fa-shop"></i>
                </div>
                <h3 class="modal-title">Post to Marketplace</h3>
                <p class="modal-desc">
                    Your asset will be listed on the public marketplace. It will be removed from your personal portfolio.
                </p>
            </div>
            
            <div class="modal-terms">
                <h4>Terms & Conditions</h4>
                <ul>
                    <li>5% platform fee on successful sale.</li>
                    <li>Listing duration is 30 days.</li>
                    <li>You can cancel anytime before sale.</li>
                </ul>
            </div>
            
            <div class="modal-actions">
                <button id="cancel-post-btn" class="btn-modal-cancel">Cancel</button>
                <button id="confirm-post-btn" class="btn-modal-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const listBody = document.getElementById('manage-asset-list');
            const editContainer = document.getElementById('edit-asset-container');
            
            // Close Button Handler
            document.getElementById('close-asset-btn').addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent bubbling
                const detailRow = document.getElementById('detail-row');
                if (detailRow) {
                    detailRow.style.display = 'none';
                }
            });

            // Render List
            function renderList() {
                listBody.innerHTML = myAssets.map((asset, index) => `
                    <tr id="asset-row-${index}" onclick="selectAsset(${index})" style="cursor: pointer;">
                        <td>
                            <div class="asset-cell">
                                <div class="asset-img-placeholder">
                                    ${asset.icon}
                                </div>
                                <div class="asset-info">
                                    <h4>${asset.title}</h4>
                                    ${asset.status === 'selling' ? '<span style="font-size: 10px; color: #EF4444; font-weight: 600;">Selling</span>' : ''}
                                </div>
                            </div>
                        </td>
                        <td><span class="badge">${asset.category}</span></td>
                        <td>$${asset.currentValue.toLocaleString()}</td>
                        <td><button class="btn" style="color: #4F46E5;">Edit</button></td>
                    </tr>
                `).join('');
            }

            let currentSimPrice = 0;
            let baseMarketPrice = 0;

            window.selectAsset = function(index) {
                const asset = myAssets[index];
                const row = document.getElementById(`asset-row-${index}`);
                
                // Check if details are already open for this row
                const nextRow = row.nextElementSibling;
                if (nextRow && nextRow.id === 'detail-row') {
                    // Toggle visibility
                    if (nextRow.style.display === 'none') {
                        nextRow.style.display = 'table-row';
                        // Re-populate if needed, but DOM is there
                    } else {
                        nextRow.style.display = 'none';
                        return; // Close and exit
                    }
                } else {
                    // Move container to new row
                    const detailRow = document.createElement('tr');
                    detailRow.id = 'detail-row';
                    const detailCell = document.createElement('td');
                    detailCell.colSpan = 4;
                    detailCell.style.padding = '0';
                    detailCell.style.borderBottom = '1px solid #E2E8F0';
                    
                    // Remove existing detail row if any
                    const existingDetailRow = document.getElementById('detail-row');
                    if (existingDetailRow) {
                        existingDetailRow.remove();
                    }

                    // Append container
                    editContainer.style.display = 'block';
                    editContainer.style.borderTop = '1px solid #E2E8F0';
                    editContainer.style.background = '#FFFFFF'; // Changed to White
                    // Padding is handled by CSS for responsiveness
                    
                    // Animation Wrapper
                    const animationWrapper = document.createElement('div');
                    animationWrapper.style.overflow = 'hidden';
                    animationWrapper.style.maxHeight = '0';
                    animationWrapper.style.opacity = '0';
                    animationWrapper.style.transition = 'max-height 0.4s ease-out, opacity 0.3s ease-in';
                    
                    animationWrapper.appendChild(editContainer);
                    detailCell.appendChild(animationWrapper);
                    detailRow.appendChild(detailCell);
                    
                    // Insert after clicked row
                    row.parentNode.insertBefore(detailRow, row.nextSibling);

                    // Trigger Animation
                    requestAnimationFrame(() => {
                        animationWrapper.style.maxHeight = '2000px'; // Large enough
                        animationWrapper.style.opacity = '1';
                    });
                }

                // Populate Fields
                document.getElementById('edit-title').value = asset.title;
                document.getElementById('edit-purchase-price').value = asset.purchasePrice;
                document.getElementById('edit-current-value-display').textContent = '$' + asset.currentValue.toLocaleString();
                document.getElementById('edit-current-value-display').style.color = asset.currentValue >= asset.purchasePrice ? '#10B981' : '#EF4444';
                document.getElementById('edit-ai-desc').textContent = asset.aiDesc;

                // Reset Valu Score UI
                const scoreSection = document.getElementById('valu-score-result');
                const scoreBtn = document.getElementById('get-valu-score-btn');
                
                if(scoreSection) scoreSection.style.display = 'none';
                
                if(scoreBtn) {
                    // Reset button state
                    scoreBtn.style.display = 'flex';
                    scoreBtn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles" style="color: #8B5CF6;"></i> Get Valu Score';
                    scoreBtn.disabled = false;
                    scoreBtn.style.opacity = '1';
                    
                    // Remove old listeners by cloning (simple way) or just re-assign onclick
                    scoreBtn.onclick = async () => {
                        // Loading state sequence
                        scoreBtn.disabled = true;
                        scoreBtn.style.opacity = '0.8';
                        
                        const steps = [
                            '<i class="fa-solid fa-circle-notch fa-spin"></i> Connecting to Market Data...',
                            '<i class="fa-solid fa-magnifying-glass fa-bounce"></i> Analyzing Rarity...',
                            '<i class="fa-solid fa-chart-line fa-fade"></i> Calculating Demand...',
                            '<i class="fa-solid fa-calculator"></i> Finalizing Score...'
                        ];

                        for (const step of steps) {
                            scoreBtn.innerHTML = step;
                            await new Promise(r => setTimeout(r, 600)); // 600ms per step
                        }
                        
                        // Calculate Scores (Simulated AI)
                        // Damage: Random 1-10
                        const damage = Math.floor(Math.random() * 10) + 1;
                        // Rarity: Random 1-10 (Simulated)
                        const rarity = Math.floor(Math.random() * 10) + 1;
                        // Demand: Random 1-10 (Simulated)
                        const demand = Math.floor(Math.random() * 10) + 1;
                        
                        // Total Score Calculation
                        const totalScore = Math.round(((damage + rarity + demand) / 30) * 100);

                        // Update UI
                        document.getElementById('score-damage').textContent = damage + '/10';
                        document.getElementById('score-rarity').textContent = rarity + '/10';
                        document.getElementById('score-demand').textContent = demand + '/10';
                        
                        const scorePercentEl = document.getElementById('score-percentage');
                        scorePercentEl.textContent = totalScore + '%';
                        
                        // Color coding for score
                        scorePercentEl.className = 'score-percentage'; // Reset
                        if(totalScore >= 80) scorePercentEl.classList.add('high');
                        else if(totalScore >= 50) scorePercentEl.classList.add('medium');
                        else scorePercentEl.classList.add('low');
                        
                        // Show Result
                        scoreSection.style.display = 'block';
                        scoreBtn.innerHTML = '<i class="fa-solid fa-rotate-right"></i> Recalculate Score';
                        scoreBtn.disabled = false;
                        scoreBtn.style.opacity = '1';

                        // Update Rent Eligibility Message
                        const rentMsgEl = document.getElementById('rent-eligibility-msg');
                        if(rentMsgEl) {
                            // Reset classes
                            rentMsgEl.className = 'rent-eligibility-msg';
                            
                            if(totalScore >= 79) {
                                rentMsgEl.innerHTML = '<i class="fa-solid fa-check-circle"></i> Request for rent eligibility.';
                                rentMsgEl.classList.add('success');
                            } else {
                                rentMsgEl.innerHTML = '<i class="fa-solid fa-circle-xmark"></i> Valu Score is not eligible for put it up for rent!';
                                rentMsgEl.classList.add('error');
                            }
                        }
                    };
                }

                // Render Chart
                const chartContainerId = 'edit-asset-chart';
                document.getElementById(chartContainerId).innerHTML = ''; // Clear
                renderAssetMiniChart(asset, chartContainerId);

                // Initialize Analysis with Current Value immediately
                updateAnalysis(asset.currentValue);
                
                // Reset Rent Eligibility Message
                const rentMsgEl = document.getElementById('rent-eligibility-msg');
                if(rentMsgEl) {
                    rentMsgEl.innerHTML = '<i class="fa-solid fa-circle-info"></i> Check your valu score if you want to put it up for rent!';
                    rentMsgEl.className = 'rent-eligibility-msg default';
                    // Remove inline styles if any were set previously
                    rentMsgEl.style.background = '';
                    rentMsgEl.style.color = '';
                    rentMsgEl.style.border = '';
                }

                // Post to Marketplace Handler
                const postBtn = document.getElementById('post-marketplace-btn');
                const modal = document.getElementById('marketplace-modal');
                const cancelBtn = document.getElementById('cancel-post-btn');
                const confirmBtn = document.getElementById('confirm-post-btn');

                if (postBtn) {
                    // Remove old listeners
                    const newPostBtn = postBtn.cloneNode(true);
                    postBtn.parentNode.replaceChild(newPostBtn, postBtn);
                    
                    // Check Status
                    if (asset.status === 'selling') {
                        newPostBtn.innerHTML = '<i class="fa-solid fa-trash" style="margin-right: 8px;"></i> Remove from Marketplace';
                        newPostBtn.className = 'btn-marketplace-action remove';
                        newPostBtn.onclick = () => {
                            if(confirm('Are you sure you want to remove this asset from the marketplace?')) {
                                // 1. Remove from Marketplace Items
                                let marketItems = JSON.parse(localStorage.getItem('marketplaceItems') || '[]');
                                marketItems = marketItems.filter(item => item.id !== asset.marketId); // Assuming we saved marketId
                                localStorage.setItem('marketplaceItems', JSON.stringify(marketItems));

                                // 2. Update My Assets Status
                                delete asset.status;
                                delete asset.marketId;
                                localStorage.setItem('myAssets', JSON.stringify(myAssets));

                                // 3. Update UI
                                renderList();
                                selectAsset(index); // Re-select to update button
                                alert('Asset removed from marketplace.');
                            }
                        };
                    } else {
                        newPostBtn.innerHTML = '<i class="fa-solid fa-shop" style="margin-right: 8px;"></i> Post your asset on marketplace';
                        newPostBtn.className = 'btn-marketplace-action';
                        newPostBtn.onclick = () => {
                            modal.style.display = 'flex';
                        };
                    }
                }

                if (cancelBtn) {
                    cancelBtn.onclick = () => {
                        modal.style.display = 'none';
                    };
                }

                if (confirmBtn) {
                    // Simple assignment - overwrites previous handler
                    confirmBtn.onclick = () => {
                        // 1. Add to Marketplace Items (localStorage)
                        let marketItems = JSON.parse(localStorage.getItem('marketplaceItems') || '[]');
                        
                        const marketId = Date.now();
                        const marketItem = {
                            ...asset,
                            price: asset.purchasePrice, // Original Value
                            est: asset.currentValue, // Est. Value
                            badge: 'Verified',
                            isNew: true, // Tag as NEW
                            seller: 'You',
                            id: marketId // New ID for marketplace
                        };
                        marketItems.unshift(marketItem); // Add to top
                        localStorage.setItem('marketplaceItems', JSON.stringify(marketItems));

                        // 2. Update My Assets Status (Do NOT remove)
                        asset.status = 'selling';
                        asset.marketId = marketId; // Link to market item
                        localStorage.setItem('myAssets', JSON.stringify(myAssets));

                        // 3. Redirect
                        window.location.href = 'marketplace.html';
                    };
                }
                
                // Save Handler
                document.getElementById('save-asset-btn').onclick = () => {
                    // Update Data
                    asset.title = document.getElementById('edit-title').value;
                    asset.purchasePrice = parseInt(document.getElementById('edit-purchase-price').value);
                    
                    // Re-render list
                    renderList();
                    
                    // Re-open the detail row for the edited asset (since renderList destroys it)
                    // We need to wait for renderList to finish
                    setTimeout(() => {
                        selectAsset(index);
                    }, 0);
                    
                    alert('Changes saved!');
                };
            };

            window.adjustPricePercent = function(percent) {
                currentSimPrice = Math.round(currentSimPrice * (1 + percent));
                updateSimulatorUI();
            }

            window.updateSimPriceFromInput = function(val) {
                const newPrice = parseInt(val);
                if (!isNaN(newPrice) && newPrice >= 0) {
                    currentSimPrice = newPrice;
                    updateSimulatorUI();
                }
            }

            function updateAnalysis(price) {
                baseMarketPrice = price;
                currentSimPrice = price;

                // 1. Sell Section - Estimated Price
                document.getElementById('sell-est-price').textContent = '$' + price.toLocaleString();
                
                // 2. Sell Section - Simulator
                updateSimulatorUI();

                // 3. Rent Section (Fixed Percentages)
                // Hourly: 1%, Daily: 5%, Monthly: 30%
                const hourly = Math.round(price * 0.01);
                const daily = Math.round(price * 0.05);
                const monthly = Math.round(price * 0.30);

                document.getElementById('rent-hourly').textContent = '$' + hourly.toLocaleString();
                document.getElementById('rent-daily').textContent = '$' + daily.toLocaleString();
                document.getElementById('rent-monthly').textContent = '$' + monthly.toLocaleString();
            }

            function updateSimulatorUI() {
                // Update Input Value
                const input = document.getElementById('sim-price-input');
                if (document.activeElement !== input) {
                    input.value = currentSimPrice;
                }
                
                const ratio = currentSimPrice / baseMarketPrice;
                const speedText = document.getElementById('sim-speed-text');
                const fillBar = document.getElementById('sim-speed-bar');
                
                let timeText = '';
                let fillPercent = 0;
                let color = '';

                if (ratio <= 0.5) {
                    timeText = 'Instantly (< 1 min)';
                    fillPercent = 10;
                    color = '#10B981'; // Green
                } else if (ratio <= 0.8) {
                    timeText = 'Very Fast (1-3 hours)';
                    fillPercent = 25;
                    color = '#34D399';
                } else if (ratio <= 0.95) {
                    timeText = 'Fast (12-24 hours)';
                    fillPercent = 40;
                    color = '#60A5FA'; // Blue
                } else if (ratio <= 1.05) {
                    timeText = 'Average (1-3 days)';
                    fillPercent = 60;
                    color = '#F59E0B'; // Orange
                } else if (ratio <= 1.2) {
                    timeText = 'Slow (1 week)';
                    fillPercent = 80;
                    color = '#F97316';
                } else {
                    timeText = 'Very Slow (1 week+)';
                    fillPercent = 100;
                    color = '#EF4444'; // Red
                }

                speedText.textContent = timeText;
                speedText.style.color = color;
                
                if (fillBar) {
                    fillBar.style.width = fillPercent + '%';
                    fillBar.style.background = color;
                }
            }

            if (typeof myAssets !== 'undefined') {
                renderList();

                // Check for URL params to auto-expand
                const urlParams = new URLSearchParams(window.location.search);
                const titleParam = urlParams.get('title');
                if (titleParam) {
                    const index = myAssets.findIndex(a => a.title === decodeURIComponent(titleParam));
                    if (index !== -1) {
                        setTimeout(() => {
                            selectAsset(index);
                            // Scroll to the element
                            const item = document.querySelectorAll('.asset-item')[index];
                            if(item) item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 100);
                    }
                }
            }
        });
    </script>
    <script>
        document.addEventListener('keydown', function(e) {
            if (e.key === '0' && window.innerWidth <= 768) {
                const postBtn = document.querySelector('.nav-actions .btn-primary');
                if (postBtn) {
                    postBtn.style.display = postBtn.style.display === 'none' ? 'flex' : 'none';
                }
            }
        });
    </script>
    <nav class="bottom-nav">
        <a href="index.html" class="bottom-nav-item">
            <i class="fa-regular fa-user"></i>
            <span>My Value</span>
        </a>
        <a href="post.html" class="bottom-nav-item active">
            <i class="fa-solid fa-list-check"></i>
            <span>Manage</span>
        </a>
        <a href="marketplace.html" class="bottom-nav-item">
            <i class="fa-solid fa-store"></i>
            <span>Market</span>
        </a>
        <a href="#" class="bottom-nav-item">
            <i class="fa-regular fa-circle-user" style="font-size: 24px;"></i>
            <span>Settings</span>
        </a>
    </nav>
</body>

</html>